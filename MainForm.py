"""Subclass of BaseMainForm, which is generated by wxFormBuilder."""

import wx
import BaseMainForm
from JHPaintObject import *

# Implementing BaseMainForm
class MainForm( BaseMainForm.BaseMainForm ):
	def __init__( self, parent ):
		BaseMainForm.BaseMainForm.__init__( self, parent )
		
		
		self.pen = wx.Pen("green", 1, wx.SOLID)
		self.brush = wx.Brush('blue', wx.TRANSPARENT)  #透明填充
		
		#For Log Message
		self.LogTarget = wx.LogWindow(self,'LogFrame',True,False)
		wx.Log.SetActiveTarget(self.LogTarget)
		
		#paint object list
		self.drawPaper = JHRect()
		self.paintObjList = []
		self.startDraggingObject = False


	def onSelectMenuItemHelpShowLog( self, event ):
		self.LogTarget.Show()
		
	def onMainPanelPaint( self, event ):
		wx.LogMessage('MainPabek onPaint')
		
	def onMainPanelLeftDown( self, event ):
		self.startDraggingObject = True
		pass
	
	def onMainPanelLeftUp( self, event ):
		self.startDraggingObject = False
		pass
	
	def onMainPanelMotion( self, event ):
		position = event.GetPosition()
		if not self.startDraggingObject:
			self.__Focus(position)
		else:
			pass
		
	def onButtonLineClick( self, event ):
		wx.LogMessage('draw Line')
		self.paintObjList.append(JHLine(10,10,200,200))
		self.paintObjList.append(JHLine(40,80,300,300))
		self.__Draw()
		
	def __Focus(self,position):
		needReDraw = False
		for obj in self.paintObjList:
			if JHFocusState.FOCUS_NONE != obj.Focus(position):
				needReDraw = True
		if needReDraw:
			self.__Draw()
				
	def __Draw( self ):
		size = self.GetClientSize()
		self.bitmap = wx.Bitmap(size.width, size.height)
		dc = wx.BufferedDC(wx.ClientDC(self.m_panel_main), self.bitmap)
		gc = wx.GraphicsContext.Create(dc)
		if gc:
			paperSize = dc.GetSize()
			self.drawPaper.ReSize(paperSize)
			self.drawPaper.Draw(gc)
			for obj in self.paintObjList:
				obj.Draw(gc)
		else:
			wx.LogMessage('__Draw gc create failed')
